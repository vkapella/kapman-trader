{
  "name": "kapman_a1_contract_v1",
  "strict": true,
  "schema": {
    "type": "object",
    "additionalProperties": false,
    "required": [
      "snapshot_metadata",
      "context_evaluation",
      "option_recommendations",
      "confidence_summary"
    ],
    "properties": {
      "snapshot_metadata": {
        "type": "object",
        "additionalProperties": false,
        "required": ["symbol", "snapshot_time"],
        "properties": {
          "symbol": { "type": "string" },
          "snapshot_time": { "type": "string" }
        }
      },

      "context_evaluation": {
        "type": "object",
        "additionalProperties": false,
        "required": ["status", "failure_type", "reason"],
        "properties": {
          "status": {
            "type": "string",
            "enum": ["ACCEPTED", "REJECTED"]
          },
          "failure_type": {
            "type": "string",
            "enum": ["NONE", "SCHEMA_FAIL", "INVALID_CHAIN", "CONTEXT_REJECTED"]
          },
          "reason": { "type": "string" }
        }
      },

      "option_recommendations": {
        "type": "object",
        "additionalProperties": false,
        "required": ["primary", "alternatives"],
        "properties": {
          "primary": {
            "type": "object",
            "additionalProperties": false,
            "required": [
              "option_type",
              "strike",
              "expiration",
              "stop_loss",
              "profit_target"
            ],
            "properties": {
              "option_type": {
                "type": "string",
                "enum": ["CALL", "PUT"]
              },
              "strike": { "type": "number" },
              "expiration": {
                "type": "string",
                "pattern": "^\\d{4}-\\d{2}-\\d{2}$"
              },
              "stop_loss": { "type": "string" },
              "profit_target": { "type": "string" }
            }
          },

          "alternatives": {
            "type": "array",
            "items": {
              "type": "object",
              "additionalProperties": false,
              "required": [
                "option_type",
                "strike",
                "expiration",
                "stop_loss",
                "profit_target"
              ],
              "properties": {
                "option_type": {
                  "type": "string",
                  "enum": ["CALL", "PUT"]
                },
                "strike": { "type": "number" },
                "expiration": {
                  "type": "string",
                  "pattern": "^\\d{4}-\\d{2}-\\d{2}$"
                },
                "stop_loss": { "type": "string" },
                "profit_target": { "type": "string" }
              }
            }
          }
        }
      },

      "confidence_summary": {
        "type": "object",
        "additionalProperties": false,
        "required": ["confidence"],
        "properties": {
          "confidence": {
            "type": "number",
            "minimum": 0,
            "maximum": 1
          }
        }
      }
    }
  }
}