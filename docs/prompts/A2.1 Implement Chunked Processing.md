You are acting as an execution engineer inside the KapMan Trader codebase.

Your task is to implement GitHub Issue **[A2.1] Local TA + Price Metrics — Chunked Execution (Single-Process)** exactly as specified below.

This is NOT architecture work.
This is NOT indicator logic work.
This is a deterministic execution refactor only.

--------------------------------------------------------------------
CONTEXT (AUTHORITATIVE)
--------------------------------------------------------------------

• Existing implementation: A2 Local TA batch job
• Existing behavior: Sequential processing of ~10,200 tickers per day
• Observed runtime: ~21 minutes per day
• Indicator surface, schemas, JSON blobs, idempotency are all CORRECT and MUST NOT change.

You are adding **ticker chunking only**, single-process, no parallelism.

--------------------------------------------------------------------
HARD CONSTRAINTS (DO NOT VIOLATE)
--------------------------------------------------------------------

• Do NOT change indicator definitions
• Do NOT change JSON schemas or key names
• Do NOT change snapshot semantics
• Do NOT introduce parallelism (no threads, no multiprocessing, no async)
• Do NOT introduce adaptive chunk sizing
• Do NOT add new tables or migrations
• Chunk size must remain fixed for the entire run
• All output MUST be deterministic and idempotent

--------------------------------------------------------------------
REQUIRED FUNCTIONAL CHANGES
--------------------------------------------------------------------

1) Add CLI flag:
   --ticker-chunk-size N

2) Encode a **static system default**:
   DEFAULT_TICKER_CHUNK_SIZE = 500

   • This value is opinionated and fixed
   • Chosen based on current dataset (~10k tickers)
   • Expected improvement: 10–20%
   • CLI flag always overrides this default

3) Partition the resolved ticker list into fixed-size chunks:
   • Deterministic order
   • Stable slicing
   • No overlap, no skipping

4) Process chunks sequentially:
   • Load OHLCV for the chunk
   • Compute indicators (unchanged logic)
   • Write daily_snapshots (unchanged upsert semantics)

--------------------------------------------------------------------
TIMING, TELEMETRY, AND ETA
--------------------------------------------------------------------

You MUST add timing instrumentation.

For each chunk:
• Start timer immediately before OHLCV load
• Stop timer immediately after DB writes

After each completed chunk compute:

avg_time_per_ticker_so_far =
    cumulative_chunk_time_sec / tickers_processed_so_far

estimated_time_remaining_sec =
    avg_time_per_ticker_so_far × remaining_tickers

--------------------------------------------------------------------
LOGGING REQUIREMENTS
--------------------------------------------------------------------

RUN HEADER (INFO, once):
• chunk size (default vs override)
• total tickers
• total chunks
• deterministic=true

PER-CHUNK LOGGING (DEBUG):
[A2] CHUNK {i}/{total_chunks}
  tickers_in_chunk={n}
  chunk_elapsed_sec={sec}
  avg_sec_per_ticker={value}
  remaining_tickers={count}
  eta_remaining_sec={sec}

HEARTBEAT (INFO, same cadence as existing):
[A2] progress snapshot_date=YYYY-MM-DD
  processed={x}/{total}
  elapsed=HH:MM:SS
  eta=HH:MM:SS

FINAL SUMMARY (INFO):
• dates processed
• total tickers
• snapshots written
• total chunks
• mean chunk time
• p95 chunk time (if trivial)
• avg sec/ticker
• total duration

--------------------------------------------------------------------
FAILURE & IDEMPOTENCY RULES
--------------------------------------------------------------------

• Indicator failures → NULL values (unchanged behavior)
• Chunk failure aborts run
• Completed chunks remain committed
• Reruns are safe due to ON CONFLICT (time, ticker_id) DO UPDATE
• Chunk size MUST NOT affect computed values

--------------------------------------------------------------------
TESTING REQUIREMENTS
--------------------------------------------------------------------

Extend existing tests only (do not add new test frameworks).

UNIT TESTS (extend existing A2 unit tests):
• Chunk partition correctness
• Default chunk size applied when flag omitted
• ETA math correctness (float tolerance allowed)
• Telemetry keys present

INTEGRATION TESTS (extend existing A2 integration test):
• Compare deterministic SAMPLE of tickers (not all)
• Same outputs with different chunk sizes
• Idempotence preserved
• Skip unless KAPMAN_TEST_DATABASE_URL is set

NO performance-based assertions.

--------------------------------------------------------------------
DELIVERABLE
--------------------------------------------------------------------

• Modify only the necessary files
• All existing tests must pass
• No behavior change outside chunking + telemetry
• Commit-ready code

Begin implementation.