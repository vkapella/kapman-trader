{
  "name": "wyckoff_context_evaluation",
  "strict": true,
  "schema": {
    "type": "object",
    "additionalProperties": false,
    "required": [
      "context_evaluation",
      "evidence_analysis",
      "context_confidence",
      "option_recommendations",
      "meta"
    ],
    "properties": {
      "context_evaluation": {
        "type": "object",
        "required": ["claimed_context", "ai_assessment"],
        "additionalProperties": false,
        "properties": {
          "claimed_context": {
            "type": "object",
            "required": ["wyckoff_regime", "confidence_provided"],
            "properties": {
              "wyckoff_regime": {
                "type": "string",
                "enum": ["ACCUMULATION", "MARKUP", "DISTRIBUTION", "MARKDOWN", "UNKNOWN"]
              },
              "confidence_provided": {
                "type": "number",
                "minimum": 0,
                "maximum": 1
              }
            }
          },
          "ai_assessment": {
            "type": "object",
            "required": ["supported", "summary"],
            "properties": {
              "supported": { "type": "boolean" },
              "summary": { "type": "string", "maxLength": 500 }
            }
          }
        }
      },

      "evidence_analysis": {
        "type": "object",
        "required": ["supporting_metrics", "contradicting_metrics", "neutral_metrics"],
        "additionalProperties": false,
        "properties": {
          "supporting_metrics": {
            "type": "array",
            "items": { "$ref": "#/$defs/metric_evidence" }
          },
          "contradicting_metrics": {
            "type": "array",
            "items": { "$ref": "#/$defs/metric_evidence" }
          },
          "neutral_metrics": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["metric", "rationale"],
              "properties": {
                "metric": { "type": "string" },
                "rationale": { "type": "string", "maxLength": 300 }
              }
            }
          }
        }
      },

      "context_confidence": {
        "type": "object",
        "required": ["score", "interpretation", "decision_guidance"],
        "properties": {
          "score": { "type": "number", "minimum": 0, "maximum": 1 },
          "interpretation": {
            "type": "string",
            "enum": ["strong_support", "moderate_support", "weak_support", "rejected"]
          },
          "decision_guidance": { "type": "string", "maxLength": 300 }
        }
      },

      "option_recommendations": {
        "type": "object",
        "required": ["primary", "alternatives"],
        "additionalProperties": false,
        "properties": {
          "primary": { "$ref": "#/$defs/option_strategy" },
          "alternatives": {
            "type": "array",
            "minItems": 2,
            "maxItems": 2,
            "items": { "$ref": "#/$defs/option_strategy" }
          }
        }
      },

      "meta": {
        "type": "object",
        "required": ["analysis_scope", "assumptions", "limitations"],
        "properties": {
          "analysis_scope": { "type": "string" },
          "assumptions": { "type": "array", "items": { "type": "string" } },
          "limitations": { "type": "array", "items": { "type": "string" } }
        }
      }
    },

    "$defs": {
      "metric_evidence": {
        "type": "object",
        "required": ["metric", "signal", "weight", "rationale"],
        "additionalProperties": false,
        "properties": {
          "metric": { "type": "string" },
          "signal": { "type": "string" },
          "weight": { "type": "number", "minimum": 0, "maximum": 1 },
          "rationale": { "type": "string", "maxLength": 300 }
        }
      },

      "option_strategy": {
        "type": "object",
        "required": [
          "condition",
          "strategy_type",
          "direction",
          "structure",
          "rationale"
        ],
        "additionalProperties": false,
        "properties": {
          "condition": {
            "type": "string",
            "enum": ["context_supported", "context_weak", "context_rejected"]
          },
          "strategy_type": {
            "type": "string",
            "enum": [
              "long_call",
              "long_put",
              "call_debit_spread",
              "put_debit_spread",
              "call_credit_spread",
              "put_credit_spread",
              "cash_secured_put"
            ]
          },
          "direction": {
            "type": "string",
            "enum": ["bullish", "bearish", "neutral", "bullish_to_neutral", "bearish_to_neutral"]
          },
          "structure": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "long_leg": { "$ref": "#/$defs/option_leg" },
              "short_leg": { "$ref": "#/$defs/option_leg" }
            }
          },
          "rationale": { "type": "string", "maxLength": 500 }
        }
      },

      "option_leg": {
        "type": "object",
        "required": ["type", "strike", "expiration"],
        "additionalProperties": false,
        "properties": {
          "type": { "type": "string", "enum": ["CALL", "PUT"] },
          "strike": { "type": "number" },
          "expiration": { "type": "string", "pattern": "^\\d{4}-\\d{2}-\\d{2}$" }
        }
      }
    }
  }
}